# JM Showroomer Backend

## Що вміє система зараз

- Авторизація через Firebase token.
- Профіль користувача (user/owner/admin ролі).
- Повний життєвий цикл шоуруму:
  - створення
  - редагування
  - відправка на модерацію
  - approve/reject
  - видалення
- Робота з лукбуками.
- Робота з івентами і станом "хочу відвідати".
- Favorites/Collections.
- Внутрішні нотифікації + read/unread.
- Push (MVP, без черг).

---

## Як працює бізнес-логіка простими словами

## 1) Коли owner створює шоурум
- Шоурум з'являється у draft.
- Owner може доповнювати дані та редагувати.
- Публічно він ще не відображається як approved.

## 2) Коли owner натискає Submit
- Статус стає `pending`.
- Запис фіксується для модерації.
- Далі рішення приймає admin.

## 3) Коли admin approve
- Статус -> `approved`.
- Шоурум доступний у публічних списках.
- Owner отримує нотифікацію.
- Push відправляється лише якщо:
  - push увімкнений,
  - user/device не вимкнули нотифікації,
  - є активний token.

## 4) Коли admin reject
- Статус -> `rejected`.
- Причина reject зберігається.
- Owner отримує нотифікацію.

## 5) Коли хтось додає showroom в favorite
- Дія ідемпотентна (повтор не створює дубль стану).
- Власник шоуруму отримує нотифікацію (крім випадку self-action).

## 6) Коли хтось додає lookbook в favorite
- Аналогічно: ідемпотентно.
- Автор lookbook отримує нотифікацію (крім self-action).

## 7) Коли користувач ставить "want-to-visit" на івент
- Стан зберігається у user collection.
- Власник івенту отримує нотифікацію (крім self-action).

---

## Нотифікації (не технічно)

Система зберігає всі ключові події у профілі користувача.
Кожна нотифікація має захист від дублювання.
Є API щоб:
- подивитися список,
- позначити як прочитану,
- отримати кількість непрочитаних.

---

## Push (високий рівень)

Push — це додатковий канал.
Навіть якщо push не відправився, бізнес-операція вважається успішною, якщо дані збережені.

Причини, коли push не піде:
- push вимкнено на рівні середовища,
- користувач вимкнув notifications,
- конкретний девайс вимкнений,
- немає валідного token.

---

## Guest -> Auth sync

Коли користувач працював як guest і потім увійшов,
його локальні стани (favorites/want-to-visit) можна синхронізувати.

Сервер:
- обмежує кількість id,
- прибирає дублікати,
- повертає `skipped` для недоступних елементів.

---
