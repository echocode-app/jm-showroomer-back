components:
  schemas:
    LookbookImage:
      type: object
      properties:
        storagePath:
          type: string
          description: Canonical Storage path.
        order:
          type: integer
        url:
          type: string
          nullable: true
          description: Signed read URL (detail endpoint only).

    Lookbook:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
          description: Backward-compatible alias for title.
        description:
          type: string
          nullable: true
        country:
          type: string
          nullable: true
        countryNormalized:
          type: string
          nullable: true
        city:
          type: string
          nullable: true
        cityNormalized:
          type: string
          nullable: true
        seasonLabel:
          type: string
          nullable: true
        seasonKey:
          type: string
          nullable: true
        sortRank:
          type: integer
          nullable: true
        coverPath:
          type: string
          nullable: true
        coverUrl:
          type: string
          nullable: true
          description: Signed read URL for cover image.
        images:
          type: array
          nullable: true
          items:
            $ref: '#/components/schemas/LookbookImage'
        source:
          type: string
          enum: [seed, owner, admin]
          nullable: true
        published:
          type: boolean
          nullable: true
        publishedAt:
          type: string
          format: date-time
          nullable: true
        createdAt:
          type: string
          format: date-time
          nullable: true
        updatedAt:
          type: string
          format: date-time
          nullable: true

paths:
  /lookbooks:
    get:
      tags: [Lookbooks]
      summary: List lookbooks
      description: |
        Public list for MVP1.
        Filters are required and applied together: country + seasonKey + published=true.
        Signed URL is generated for coverPath only.
      operationId: listLookbooks
      security: []
      parameters:
        - name: country
          in: query
          required: true
          schema:
            type: string
        - name: seasonKey
          in: query
          required: true
          schema:
            type: string
            example: ss-2026
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
        - name: cursor
          in: query
          schema:
            type: string
          description: Base64 backend cursor. Do not construct client-side.
      responses:
        "200":
          description: Lookbooks list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './common.yaml#/components/schemas/ApiSuccess'
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbooks:
                            type: array
                            items:
                              $ref: '#/components/schemas/Lookbook'
                      meta:
                        type: object
                        properties:
                          hasMore:
                            type: boolean
                          nextCursor:
                            type: string
                            nullable: true
                          paging:
                            type: string
                            enum: [enabled, end]
        "400":
          description: Invalid query or cursor
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'
        "503":
          description: Missing required Firestore index (INDEX_NOT_READY)
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'

  /lookbooks/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    get:
      tags: [Lookbooks]
      summary: Get lookbook by id
      description: Returns published lookbook only. Cover and all images include signed URLs.
      operationId: getLookbookById
      security: []
      responses:
        "200":
          description: Lookbook details
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './common.yaml#/components/schemas/ApiSuccess'
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbook:
                            $ref: '#/components/schemas/Lookbook'
        "404":
          description: Not found or unpublished
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'

  /lookbooks/{id}/favorite:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    post:
      tags: [Lookbooks]
      summary: Add lookbook to favorites
      description: Auth-only, idempotent.
      operationId: favoriteLookbook
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Favorited
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './common.yaml#/components/schemas/ApiSuccess'
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbookId:
                            type: string
                          status:
                            type: string
                            example: favorited
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'
        "404":
          description: Lookbook not found
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'
    delete:
      tags: [Lookbooks]
      summary: Remove lookbook from favorites
      description: Auth-only, idempotent.
      operationId: unfavoriteLookbook
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Removed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './common.yaml#/components/schemas/ApiSuccess'
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbookId:
                            type: string
                          status:
                            type: string
                            example: removed
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'

  /lookbooks/create:
    post:
      tags: [Lookbooks]
      summary: Create lookbook (stub)
      description: MVP2. Stub in MVP1.
      operationId: createLookbook
      security:
        - bearerAuth: []
      x-roles: [owner, manager]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                description:
                  type: string
      responses:
        "200":
          description: Lookbook created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './common.yaml#/components/schemas/ApiSuccess'
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbook:
                            type: object
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'

  /lookbooks/{id}/rsvp:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
    post:
      tags: [Lookbooks]
      summary: RSVP to lookbook (stub)
      description: MVP2. Stub in MVP1.
      operationId: rsvpLookbook
      security:
        - bearerAuth: []
      responses:
        "200":
          description: RSVP response
          content:
            application/json:
              schema:
                allOf:
                  - $ref: './common.yaml#/components/schemas/ApiSuccess'
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbookId:
                            type: string
                          user:
                            type: string
                          status:
                            type: string
                            example: RSVPed
        "400":
          description: Validation error
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: './common.yaml#/components/schemas/ApiError'
