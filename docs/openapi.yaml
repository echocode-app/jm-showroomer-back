openapi: 3.0.3

info:
  title: JM Showroomer API
  description: Backend API for Flutter and Web clients
  version: "1.1.0"
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://jm-showroomer-back.onrender.com/api/v1
    description: Production
  - url: http://localhost:3005/api/v1
    description: Local dev
    x-internal: true

tags:
  - name: Health
    description: Service health endpoints
  - name: Auth
    description: Authentication and OAuth
  - name: Users
    description: User profile, roles, onboarding
  - name: Showrooms
    description: Showroom management
  - name: Lookbooks
    description: Lookbooks and RSVPs (WIP)

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase ID Token

  schemas:
    ApiSuccess:
      type: object
      required: [success, data]
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
        meta:
          type: object
          nullable: true

    ApiError:
      type: object
      required: [success, error]
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          required: [code, message]
          properties:
            code:
              type: string
              description: |
                Possible values:
                - AUTH_INVALID
                - AUTH_MISSING
                - FORBIDDEN
                - COUNTRY_BLOCKED
                - VALIDATION_ERROR
                - RATE_LIMIT_EXCEEDED
                - SHOWROOM_NOT_FOUND
                - SHOWROOM_NOT_EDITABLE
                - NO_FIELDS_TO_UPDATE
                - COUNTRY_REQUIRED
                - SHOWROOM_NAME_REQUIRED
                - SHOWROOM_TYPE_REQUIRED
                - ACCESS_DENIED
                - USER_NOT_FOUND
            message:
              type: string

    User:
      type: object
      required: [uid, role, status, onboardingState]
      properties:
        uid:
          type: string
        email:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        avatar:
          type: string
          nullable: true

        role:
          type: string
          enum: [guest, user, owner, admin]

        roles:
          type: array
          items:
            type: string

        status:
          type: string
          enum: [active, suspended, banned]

        onboardingState:
          type: string
          enum: [new, completed]

        roleRequest:
          type: object
          nullable: true
          properties:
            role:
              type: string
              enum: [owner]
            status:
              type: string
              enum: [pending, approved, rejected]
            requestedAt:
              type: string
              format: date-time
              nullable: true
            reviewedAt:
              type: string
              format: date-time
              nullable: true
            reviewedBy:
              type: string
              nullable: true
            reason:
              type: string
              nullable: true

        country:
          type: string
          nullable: true

        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Contacts:
      type: object
      properties:
        phone:
          type: string
          nullable: true
        instagram:
          type: string
          nullable: true

    Showroom:
      type: object
      required: [id, ownerUid, name, type, country, status]
      properties:
        id:
          type: string
        ownerUid:
          type: string

        name:
          type: string

        type:
          type: string
          enum: [multibrand, unique]

        availability:
          type: string
          enum: [open, appointment]
          nullable: true

        category:
          type: string
          nullable: true

        brands:
          type: array
          items:
            type: string

        address:
          type: string
          nullable: true

        country:
          type: string

        city:
          type: string
          nullable: true

        contacts:
          $ref: "#/components/schemas/Contacts"

        location:
          type: object
          nullable: true
          properties:
            lat:
              type: number
            lng:
              type: number

        status:
          type: string
          enum: [draft, pending, approved, rejected]

        editCount:
          type: integer

        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateShowroomInput:
      type: object
      required: [name, type, country]
      properties:
        name:
          type: string
        type:
          type: string
          enum: [multibrand, unique]
        availability:
          type: string
          enum: [open, appointment]
        category:
          type: string
        brands:
          type: array
          items:
            type: string
        address:
          type: string
        country:
          type: string
          description: |
            Showroom country.
            Russia (RU) and Belarus (BY) are blocked.
          example: Ukraine
        city:
          type: string
        contacts:
          $ref: "#/components/schemas/Contacts"
        location:
          type: object
          properties:
            lat:
              type: number
            lng:
              type: number

    UpdateShowroomInput:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
          enum: [multibrand, unique]
        availability:
          type: string
          enum: [open, appointment]
        category:
          type: string
        brands:
          type: array
          items:
            type: string
        address:
          type: string
        country:
          type: string
        city:
          type: string
        contacts:
          $ref: "#/components/schemas/Contacts"
        location:
          type: object
          properties:
            lat:
              type: number
            lng:
              type: number

    Lookbook:
      type: object
      description: Lookbook (Work in Progress - not fully implemented)
      properties:
        id:
          type: string
        ownerUid:
          type: string
        name:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        createdAt:
          type: string
          format: date-time

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      operationId: healthCheck
      security: []
      responses:
        "200":
          description: Service is running
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "ok"
                  env:
                    type: string
                  timestamp:
                    type: string
                    format: date-time

  /auth/oauth:
    post:
      tags: [Auth]
      summary: Google OAuth login (Firebase)
      security: []
      description: Authenticates user with Firebase Google ID Token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [idToken]
              properties:
                idToken:
                  type: string
                  description: Firebase ID Token from Google Sign-In
      responses:
        "200":
          description: Authenticated user
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: "#/components/schemas/User"
        "401":
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /auth/apple:
    post:
      tags: [Auth]
      summary: Apple OAuth login (coming soon)
      description: Endpoint for Apple OAuth login. Currently not implemented.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - idToken
              properties:
                idToken:
                  type: string
      responses:
        "501":
          description: Apple OAuth coming soon
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Apple OAuth coming soon"

  /users/me:
    get:
      tags: [Users]
      summary: Get current user
      description: Returns the profile of the currently authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: User profile
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: "#/components/schemas/User"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /users/request-owner:
    post:
      tags: [Users]
      summary: Request OWNER role
      description: |
        Requests ownership role for the current user.
        The request will be pending until reviewed by an admin.
      responses:
        "200":
          description: Request submitted successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Owner role request submitted"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "403":
          description: Forbidden - only users can request owner role
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /users/complete-onboarding:
    post:
      tags: [Users]
      summary: Complete onboarding
      description: |
        Completes user onboarding by setting the user country.
        Users from blocked countries (Russia, Belarus) are not allowed.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [country]
              properties:
                country:
                  type: string
                  example: Ukraine
                  description: User country. Russia and Belarus are blocked.
      responses:
        "200":
          description: Onboarding completed or already completed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            enum:
                              - "Onboarding completed"
                              - "Onboarding already completed"
        "400":
          description: Country is required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "403":
          description: Country is blocked
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiError"
                  - properties:
                      error:
                        properties:
                          code:
                            type: string
                            example: COUNTRY_BLOCKED
                          message:
                            type: string
                            example: "Country is not supported"

  /users/dev/register-test:
    post:
      tags: [Users]
      summary: Dev create test user
      description: Development endpoint for creating test users
      x-internal: true
      responses:
        "200":
          description: Test user created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiSuccess"

  /showrooms:
    get:
      tags: [Showrooms]
      summary: List showrooms
      description: |
        Returns a list of approved showrooms.
        Unauthenticated users see only approved showrooms.
        Owners see their own showrooms.
        Admins can filter by status.
      security: []
      parameters:
        - name: country
          in: query
          schema:
            type: string
          description: Filter by country
        - name: city
          in: query
          schema:
            type: string
          description: Filter by city
        - name: type
          in: query
          schema:
            type: string
            enum: [multibrand, unique]
          description: Filter by showroom type
        - name: availability
          in: query
          schema:
            type: string
            enum: [open, appointment]
          description: Filter by availability
        - name: status
          in: query
          schema:
            type: string
            enum: [draft, pending, approved, rejected]
          description: Filter by status (owner/admin only)
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
          description: Maximum number of results
      responses:
        "200":
          description: Showrooms list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          showrooms:
                            type: array
                            items:
                              $ref: "#/components/schemas/Showroom"

  /showrooms/create:
    post:
      tags: [Showrooms]
      summary: Create showroom
      description: |
        Creates a new showroom.
        Showrooms in blocked countries (Russia, Belarus) are not allowed.
        Requires OWNER or MANAGER role.
      security:
        - bearerAuth: []
      x-roles: [owner, manager]
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateShowroomInput"
      responses:
        "200":
          description: Showroom created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          showroom:
                            $ref: "#/components/schemas/Showroom"
        "400":
          description: Validation error (missing required fields)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "403":
          description: Forbidden (role or country restriction)
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiError"
                  - properties:
                      error:
                        properties:
                          code:
                            type: string
                            example: COUNTRY_BLOCKED
                          message:
                            type: string
                            example: "Country is not supported"


  /showrooms/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Showroom ID

    get:
      tags: [Showrooms]
      summary: Get showroom by ID
      description: |
        Returns showroom details.
        Non-approved showrooms are only visible to owners and admins.
      security: []
      responses:
        "200":
          description: Showroom
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          showroom:
                            $ref: "#/components/schemas/Showroom"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "403":
          description: Forbidden - not approved and not owner/admin
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    patch:
      tags: [Showrooms]
      summary: Update showroom
      description: |
        Updates showroom details.
        Only owners can update their showrooms.
        Only draft or rejected showrooms can be edited.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateShowroomInput"
      responses:
        "200":
          description: Showroom updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          showroom:
                            $ref: "#/components/schemas/Showroom"
        "400":
          description: Validation error or no fields to update
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "403":
          description: Forbidden - not owner or showroom not editable
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "404":
          description: Showroom not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /showrooms/{id}/favorite:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Showroom ID

    post:
      tags: [Showrooms]
      summary: Add showroom to favorites
      description: Adds a showroom to user's favorites (stub implementation)
      security:
        - bearerAuth: []
      responses:
        "200":
          description: Added to favorites
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          message:
                            type: string
                            example: "Added to favorites (stub)"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /lookbooks:
    get:
      tags: [Lookbooks]
      summary: List lookbooks
      description: Returns list of lookbooks (Work in Progress)
      security: []
      responses:
        "200":
          description: Lookbooks list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbooks:
                            type: array
                            items:
                              $ref: "#/components/schemas/Lookbook"

  /lookbooks/create:
    post:
      tags: [Lookbooks]
      summary: Create lookbook
      description: |
        Creates a new lookbook.
        Requires OWNER or MANAGER role.
        (Work in Progress - basic implementation)
      security:
        - bearerAuth: []
      x-roles: [owner, manager]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  nullable: true
                description:
                  type: string
                  nullable: true
      responses:
        "200":
          description: Lookbook created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          lookbook:
                            $ref: "#/components/schemas/Lookbook"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
        "403":
          description: Forbidden - owner/manager role required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /lookbooks/{id}/rsvp:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string
        description: Lookbook/Event ID

    post:
      tags: [Lookbooks]
      summary: RSVP to event
      description: |
        RSVP to a lookbook/event.
        (Work in Progress - basic implementation)
      security:
        - bearerAuth: []
      responses:
        "200":
          description: RSVP confirmed
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          eventId:
                            type: string
                          user:
                            type: string
                          status:
                            type: string
                            example: "RSVPed"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

