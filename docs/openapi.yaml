openapi: 3.0.3

info:
  title: JM Showroomer API
  description: Backend API for Flutter and Web clients
  version: "1.1.0"
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://jm-showroomer-back.onrender.com/api/v1
    description: Production
  - url: http://localhost:3005/api/v1
    description: Local dev
    x-internal: true

tags:
  - name: Health
    description: Service health endpoints
  - name: Auth
    description: Authentication and OAuth
  - name: Users
    description: User profile, roles, onboarding
  - name: Showrooms
    description: Showroom management
  - name: Lookbooks
    description: Lookbooks and RSVPs

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Firebase ID Token

  schemas:
    ApiSuccess:
      type: object
      required: [success, data]
      properties:
        success:
          type: boolean
          example: true
        data:
          type: object
        meta:
          type: object
          nullable: true

    ApiError:
      type: object
      required: [success, error]
      properties:
        success:
          type: boolean
          example: false
        error:
          type: object
          required: [code, message]
          properties:
            code:
              type: string
            message:
              type: string

    User:
      type: object
      required: [uid, role, status, onboardingState]
      properties:
        uid:
          type: string
        email:
          type: string
          nullable: true
        name:
          type: string
          nullable: true
        avatar:
          type: string
          nullable: true

        role:
          type: string
          enum: [guest, user, owner, admin]

        roles:
          type: array
          items:
            type: string

        status:
          type: string
          enum: [active, suspended, banned]

        onboardingState:
          type: string
          enum: [new, completed]

        roleRequest:
          type: object
          nullable: true
          properties:
            role:
              type: string
              enum: [owner]
            status:
              type: string
              enum: [pending, approved, rejected]
            requestedAt:
              type: string
              format: date-time
              nullable: true
            reviewedAt:
              type: string
              format: date-time
              nullable: true
            reviewedBy:
              type: string
              nullable: true
            reason:
              type: string
              nullable: true

        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Contacts:
      type: object
      properties:
        phone:
          type: string
          nullable: true
        instagram:
          type: string
          nullable: true
        website:
          type: string
          nullable: true
        telegram:
          type: string
          nullable: true

    Showroom:
      type: object
      required: [id, ownerUid, name, type, country, status]
      properties:
        id:
          type: string
        ownerUid:
          type: string

        name:
          type: string

        type:
          type: string
          enum: [multibrand, unique]

        availability:
          type: string
          enum: [open, appointment]
          nullable: true

        category:
          type: string
          nullable: true

        brands:
          type: array
          items:
            type: string

        address:
          type: string
          nullable: true

        country:
          type: string

        city:
          type: string
          nullable: true

        contacts:
          $ref: "#/components/schemas/Contacts"

        location:
          type: object
          nullable: true
          properties:
            lat:
              type: number
            lng:
              type: number

        status:
          type: string
          enum: [draft, pending, approved, rejected]

        editCount:
          type: integer

        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    CreateShowroomInput:
      type: object
      required: [name, type, country]
      properties:
        name:
          type: string
        type:
          type: string
          enum: [multibrand, unique]
        availability:
          type: string
          enum: [open, appointment]
        category:
          type: string
        brands:
          type: array
          items:
            type: string
        address:
          type: string
        country:
          type: string
        city:
          type: string
        contacts:
          $ref: "#/components/schemas/Contacts"
        location:
          type: object
          properties:
            lat:
              type: number
            lng:
              type: number

    UpdateShowroomInput:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
          enum: [multibrand, unique]
        availability:
          type: string
          enum: [open, appointment]
        category:
          type: string
        brands:
          type: array
          items:
            type: string
        address:
          type: string
        country:
          type: string
        city:
          type: string
        contacts:
          $ref: "#/components/schemas/Contacts"
        location:
          type: object
          properties:
            lat:
              type: number
            lng:
              type: number

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check
      operationId: healthCheck
      security: []
      responses:
        "200":
          description: Service is running
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiSuccess"
        "500":
          description: Service unavailable
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /auth/oauth:
    post:
      tags: [Auth]
      summary: Google OAuth login (Firebase)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [idToken]
              properties:
                idToken:
                  type: string
      responses:
        "200":
          description: Authenticated user
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: "#/components/schemas/User"
  /auth/apple:
    post:
      tags: [Auth]
      summary: Apple OAuth login (coming soon)
      description: Endpoint for Apple OAuth login. Currently not implemented (returns 501).
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - idToken
              properties:
                idToken:
                  type: string
      responses:
        "501":
          description: Apple OAuth coming soon
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Apple OAuth coming soon"

  /users/me:
    get:
      tags: [Users]
      summary: Get current user
      responses:
        "200":
          description: User profile
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: "#/components/schemas/User"

  /users/request-owner:
    post:
      tags: [Users]
      summary: Request OWNER role
      responses:
        "200":
          description: Request submitted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiSuccess"

  /users/complete-onboarding:
    post:
      tags: [Users]
      summary: Complete onboarding
      responses:
        "200":
          description: Onboarding completed
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiSuccess"

  /users/dev/register-test:
    post:
      tags: [Users]
      summary: Dev create test user
      x-internal: true
      responses:
        "200":
          description: Test user created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiSuccess"

  /showrooms:
    get:
      tags: [Showrooms]
      summary: List showrooms
      security: []
      responses:
        "200":
          description: Showrooms list
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          showrooms:
                            type: array
                            items:
                              $ref: "#/components/schemas/Showroom"

  /showrooms/create:
    post:
      tags: [Showrooms]
      summary: Create showroom
      security:
        - bearerAuth: []
      x-roles: [OWNER, MANAGER]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateShowroomInput"
      responses:
        "200":
          description: Created
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          showroom:
                            $ref: "#/components/schemas/Showroom"

  /showrooms/{id}:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string

    get:
      tags: [Showrooms]
      summary: Get showroom by ID
      operationId: getShowroomById
      security: []
      responses:
        "200":
          description: Showroom
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/ApiSuccess"
                  - properties:
                      data:
                        type: object
                        properties:
                          showroom:
                            $ref: "#/components/schemas/Showroom"
        "404":
          description: Not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

    patch:
      tags: [Showrooms]
      summary: Update showroom
      operationId: updateShowroom
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateShowroomInput"
      responses:
        "200":
          description: Updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiSuccess"
        "403":
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"

  /showrooms/{id}/favorite:
    parameters:
      - name: id
        in: path
        required: true
        schema:
          type: string

    post:
      tags: [Showrooms]
      summary: Add showroom to favorites
      operationId: favoriteShowroom
      responses:
        "200":
          description: Added
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiSuccess"
        "401":
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ApiError"
