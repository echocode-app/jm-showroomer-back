# JM Showroomer Backend

## Що робить бекенд
Бекенд JM Showroomer — це серверна частина, яка забезпечує:
- авторизацію користувачів через Firebase;
- зберігання даних шоурумів у Firestore;
- бізнес‑правила створення та модерації шоурумів;
- контроль ролей і доступів;
- валідації даних (ім’я, телефон, інстаграм, країни);
- анти‑дублі та анти‑спам логіку.

## Що вже виконано
- **Авторизація через Firebase ID token**.
- **Онбординг користувача** з перевіркою країни.
- **Ролі**: guest → user → owner (admin — у плані).
- **Showroom draft flow**:
  - створення чернетки,
  - збереження по кроках,
  - submit на модерацію.
- **Валідації**:
  - назва шоуруму,
  - телефон (E.164),
  - Instagram URL.
- **Блок країн**: russia / belarus (RU/BY).
- **Анти‑дублі**:
  - дубль імені для власника,
  - глобальний дубль (name + address) у pending/approved.
- **API контракт** у OpenAPI (`docs/openapi.yaml` + модульні файли).
- **E2E тести** через bash скрипти.

## Основні флоу (як працює для бізнесу)

### 1) Авторизація
- Мобільний клієнт логіниться через Firebase.
- Отриманий `idToken` передається в бекенд:
  `Authorization: Bearer <token>`.

### 2) Онбординг
- Користувач обирає країну:
  `POST /users/complete-onboarding`.
- Якщо країна заблокована (russia, belarus) → 403 COUNTRY_BLOCKED.

### 3) Запит на роль Owner
- USER може подати запит на OWNER:
  `POST /users/request-owner`.
- Далі це має підтверджуватися модерацією (admin workflow у плані).

### 4) Створення шоуруму (draft → submit)
**Кроки:**
1. **Створення або отримання чернетки**:
   `POST /showrooms/draft`
2. **Поступове заповнення** (кілька PATCH):
   `PATCH /showrooms/{id}`
3. **Submit на модерацію**:
   `POST /showrooms/{id}/submit`

**Статуси:**
- `draft` — чернетка (редагується),
- `pending` — відправлено на модерацію,
- `approved` — підтверджено,
- `rejected` — відхилено (можна виправити та відправити знову).

### 5) Валідації
- **Назва шоуруму:** 2–60 символів, не лише цифри, без повторів 5+ разів, без емодзі.
- **Телефон:** тільки у форматі E.164 (має починатись з +).
- **Instagram:** тільки instagram.com з handle.

### 6) Анти‑дублювання
- Заборонено створювати шоуруми з однаковою назвою для одного owner.
- Заборонено подавати на модерацію шоурум з таким самим name+address, якщо вже є pending або approved.

## Бізнес‑логіка доступу
- **guest:** тільки перегляд approved шоурумів.
- **user:** проходить онбординг, може запитати owner роль.
- **owner:** створює та редагує свої шоуруми, відправляє на модерацію.
- **admin:** у майбутньому — модерація шоурумів та ролей.

## Де дивитися повний контракт API
- `docs/openapi.yaml`
- Додаткові модулі в `docs/` (auth, users, showrooms, lookbooks тощо).
